---
title: "CviÄenÃ­ 9: ggplot2 - Vizualizace dat"
subtitle: "MPE_AVED - AnalÃ½za a vizualizace ekonomickÃ½ch dat"
author: "VaÅ¡e meno"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    toc_depth: 3
    number_sections: true
    theme: cosmo
    highlight: tango
    code_folding: show
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  warning = FALSE,
  message = FALSE,
  comment = "#>",
  fig.width = 8,
  fig.height = 6
)
```

# ğŸ“š Ãšvod

V tomto cviÄenÃ­ si procviÄÃ­te pouÅ¾Ã­vÃ¡nÃ­ zÃ¡kladnÃ­ch nÃ¡strojÅ¯ z balÃ­ku **ggplot2**, kterÃ© znÃ¡te z pÅ™ednÃ¡Å¡ky:

- **`ggplot()`** - inicializace grafu
- **`aes()`** - mapovÃ¡nÃ­ promÄ›nnÃ½ch na estetickÃ© vlastnosti
- **Geomy** - `geom_point()`, `geom_line()`, `geom_bar()`, `geom_histogram()` atd.
- **Facety** - `facet_wrap()`, `facet_grid()`
- **TÃ©mata** - `theme_*()` a dalÅ¡Ã­ nastavenÃ­ vzhledu
- **Å kÃ¡ly** - `scale_*()` funkce pro Ãºpravu os a barev

# ğŸ“¦ NaÄÃ­tÃ¡nÃ­ balÃ­kÅ¯

```{r packages}
# NaÄtÄ›te potÅ™ebnÃ© balÃ­ky
library(tidyverse)

```

---

# ğŸ”¥ CviÄenÃ­ na rozehÅ™Ã¡tÃ­: ÃšmrtÃ­ Å™idiÄÅ¯ v UK a noÅ¡enÃ­ pÃ¡sÅ¯

Analyzujte data o ÃºmrtÃ­ch Å™idiÄÅ¯ ve VelkÃ© BritÃ¡nii v souvislosti se zavedenÃ­m povinnÃ©ho pouÅ¾Ã­vÃ¡nÃ­ bezpeÄnostnÃ­ch pÃ¡sÅ¯.

## NaÄtenÃ­ a prozkoumÃ¡nÃ­ dat

```{r rozehnuti_data}
# NaÄtÄ›te data
seatbelts <- datasets::Seatbelts %>% 
  as.matrix()

seatbelts <- data.frame(as.matrix(seatbelts), year=time(seatbelts), month = cycle(seatbelts)) %>% 
    as_tibble() %>% 
    mutate(
        year = as.character(year) %>% str_extract("^\\d{4}"),
        month = ifelse(month < 10, str_c("0",month), as.character(month)),
        date = str_c(year,"-",month,"-01") %>% as.Date()
    )
# Prozkoumejte strukturu dat


```

## ZÃ¡kladnÃ­ vizualizace

```{r rozehnuti_vizualizace}
# VytvoÅ™te zÃ¡kladnÃ­ bodovÃ½ graf

seatbelts |> 
  ggplot(aes(x = date, y = drivers)) +
    geom_line()

```

## MalÃ© rozÅ¡Ã­Å™enÃ­...

```{r rozehnuti_male_rozsireni}
# PÅ™idejte dalÅ¡Ã­ estetickÃ© vlastnosti (barva, tvar bodÅ¯)
seatbelts |>
  mutate(
    law = law > 0
  ) |> 
  ggplot(
    aes(x = date, y = drivers, color = law)
    ) +
  geom_line()

```

## ZajÃ­mavÄ›jÅ¡Ã­ rozÅ¡Ã­Å™enÃ­...
nejaka rozumna transformacia hodnot do farieb

```{r rozehnuti_zajimave_rozsireni}
# PÅ™idejte trendy, popisky, vylepÅ¡ete vzhled
# skalovanie hodnoty do farieb - colorbrewer2.org
seatbelts |>
  mutate(
    law = law > 0
  ) |> 
  ggplot(
    aes(x = date, y = drivers, color = law)
    ) +
  geom_line() +
  scale_color_brewer(
    "Plati zakon o povinnem \nnoseni pasu?",
    palette = "Dark2",
    labels = c("TRUE" = "Ano", "FALSE" = "Ne")
  )

seatbelts |>
  mutate(
    law = law > 0
  ) |> 
  ggplot(
    aes(x = date, y = drivers, color = law)
    ) +
  geom_line() +
  geom_point() +
  scale_color_brewer(
    "Plati zakon o povinnem \nnoseni pasu?",
    palette = "Dark2",
    labels = c("TRUE" = "Ano", "FALSE" = "Ne")
  )

seatbelts |>
  mutate(
    law = law > 0
  ) |> 
  ggplot(
    aes(x = date, y = drivers, color = law)
    ) +
  geom_line() +
  geom_point() +
  annotate( # vykreslenie hranic je podla dat, nie podla annotate
    "rect",
    ymin = -Inf,
    ymax = Inf,
    xmax = Inf,
    xmin = as.Date("1983-01-31")
  ) +
  scale_color_brewer(
    "Plati zakon o povinnem \nnoseni pasu?",
    palette = "Dark2",
    labels = c("TRUE" = "Ano", "FALSE" = "Ne")
  )

# zmena poradia prvkov a ciastocna priehladnost
seatbelts |>
  mutate(
    law = law > 0
  ) |> 
  ggplot(
    aes(x = date, y = drivers, color = law)
    ) +
  annotate( 
    "rect",
    ymin = -Inf,
    ymax = Inf,
    xmax = Inf,
    xmin = as.Date("1983-01-31"),
    alpha = 0.3
  ) +
  geom_line() +
  geom_point() +
  scale_color_brewer(
    "Plati zakon o povinnem \nnoseni pasu?",
    palette = "Dark2",
    labels = c("TRUE" = "Ano", "FALSE" = "Ne")
  )

# smooth
seatbelts |>
  mutate(
    law = law > 0
  ) |> 
  ggplot(
    aes(x = date, y = drivers, color = law)
    ) +
  annotate( 
    "rect",
    ymin = -Inf,
    ymax = Inf,
    xmax = Inf,
    xmin = as.Date("1983-01-31"),
    alpha = 0.3
  ) +
  geom_line() +
  geom_point() +
  geom_smooth() +
  scale_color_brewer(
    "Plati zakon o povinnem \nnoseni pasu?",
    palette = "Dark2",
    labels = c("TRUE" = "Ano", "FALSE" = "Ne")
  )

# odstranenie farby, ale namiesto toho group
seatbelts |>
  mutate(
    law = law > 0
  ) |> 
  ggplot(
    aes(x = date, y = drivers, group = law)
    ) +
  annotate( 
    "rect",
    ymin = -Inf,
    ymax = Inf,
    xmax = Inf,
    xmin = as.Date("1983-01-31"),
    alpha = 0.3
  ) +
  geom_line() +
  geom_point() +
  geom_smooth() +
  scale_color_brewer(
    "Plati zakon o povinnem \nnoseni pasu?",
    palette = "Dark2",
    labels = c("TRUE" = "Ano", "FALSE" = "Ne")
  )

```

---

# ğŸ’ª CviÄenÃ­ A: Ve zdravÃ©m tÄ›le...

Vizualizace dat o zdravÃ­ a fyzickÃ© kondici.

## NaÄtenÃ­ dat

```{r ukol_a_nacteni}
# NaÄtÄ›te data
oly12 <- VGAMdata::oly12 %>%
  as_tibble()

# ZobrazenÃ­ prvnÃ­ch Å™Ã¡dkÅ¯
print(oly12)

```

## Ãškol A.1: ExplorativnÃ­ vizualizace

```{r ukol_a_1}
# VytvoÅ™te zÃ¡kladnÃ­ grafy pro pochopenÃ­ dat
oly12 |> 
  ggplot(
    aes(x = Height, y = Weight)
  ) + 
  geom_point()
# prilis vela bodov, vola sa to overplotting


# pohlavie
oly12 |> 
  arrange(Sex) |> 
  ggplot(
    aes(x = Height, y = Weight, color = Sex)
  ) + 
  geom_point()

# priehladnost bodov
oly12 |> 
  arrange(Sex) |> 
  ggplot(
    aes(x = Height, y = Weight, color = Sex)
  ) + 
  geom_point(
    alpha = 0.1
  )

# pridam geom_smooth
oly12 |> 
  arrange(Sex) |> 
  ggplot(
    aes(x = Height, y = Weight, color = Sex)
  ) + 
  geom_point(
    size = 0.1,
    alpha = 0.1
  ) +
  geom_smooth()

# namiesto stvorcov sestuholniky
oly12 |> 
  arrange(Sex) |> 
  ggplot(
    aes(x = Height, y = Weight)
  ) + 
  geom_hex()

# vlastnosti
oly12 |> 
  arrange(Sex) |> 
  ggplot(
    aes(x = Height, y = Weight)
  ) + 
  geom_hex() +
  scale_fill_distiller(
    palette = "Green",
    direction = -1
  )

# rozdel na facety
oly12 |> 
  arrange(Sex) |> 
  ggplot(
    aes(x = Height, y = Weight)
  ) + 
  geom_hex() +
  scale_fill_distiller(
    palette = "Green",
    direction = -1
  ) +
  facet_wrap(~Sex) # rovnake hranice

oly12 |> 
  arrange(Sex) |> 
  ggplot(
    aes(x = Height, y = Weight, color = Sex)
  ) + 
  geom_density_2d()

# iny pristup: vybrat nahodny set


oly12_sample <- oly12 |> 
  group_by(Sex) |>
  slice_sample(n = 1000) |> 
  ungroup()

set.seed(42)
oly12_sample |> 
  arrange(Sex) |> 
  ggplot(
    aes(x = Height, y = Weight, color = Sex)
  ) + 
  geom_density_2d()

```

## Ãškol A.2: BodovÃ½ graf s trendem

```{r ukol_a_2}
# VytvoÅ™te scatter plot s trendovou ÄÃ¡rou


```

## Ãškol A.3: FacetovÃ¡nÃ­ podle kategoriÃ­

```{r ukol_a_3}
# PouÅ¾ijte facet_wrap() nebo facet_grid()


```

## Ãškol A.4: VylepÅ¡enÃ­ vzhledu

```{r ukol_a_4}
# Upravte tÃ©mata, barvy a popisky


```

---

# ğŸ“Š CviÄenÃ­ B: RozdÄ›lenÃ­ spojitÃ© promÄ›nnÃ©

PrÃ¡ce s histogramy, hustotnÃ­mi grafy a dalÅ¡Ã­mi vizualizacemi distribucÃ­.

## NaÄtenÃ­ dat

```{r ukol_b_nacteni}
# NaÄtÄ›te data


# Prozkoumejte data


```

## Ãškol B.1: Histogram

```{r ukol_b_1}
# VytvoÅ™te histogram spojitÃ© promÄ›nnÃ©


```

## Ãškol B.2: HustotnÃ­ graf

```{r ukol_b_2}
# VytvoÅ™te density plot


```

## Ãškol B.3: Box plot

```{r ukol_b_3}
# VytvoÅ™te krabicovÃ½ graf podle kategoriÃ­


```

## Ãškol B.4: Violin plot

```{r ukol_b_4}
# VytvoÅ™te houslovÃ½ graf


```

## Ãškol B.5: Kombinace geomÅ¯

```{r ukol_b_5}
# Kombinujte vÃ­ce geomÅ¯ v jednom grafu


```

---

# ğŸ¨ CviÄenÃ­ C: KomplexnÃ­ vizualizace

VytvoÅ™enÃ­ profesionÃ¡lnÃ­ vizualizace s pouÅ¾itÃ­m vÅ¡ech nauÄenÃ½ch technik.

## NaÄtenÃ­ dat

```{r ukol_c_nacteni}
# NaÄtÄ›te data


# PÅ™Ã­prava dat pro vizualizaci


```

## Krok 1: Vizualizace dat

VytvoÅ™te zÃ¡kladnÃ­ vizualizaci dat.

```{r ukol_c_krok1}
# ZÃ¡kladnÃ­ graf s vhodnÃ½mi geomy


```

## Krok 2: NastavenÃ­ mapovÃ¡nÃ­

Nastavte estetickÃ© mapovÃ¡nÃ­ pro lepÅ¡Ã­ interpretaci dat.

```{r ukol_c_krok2}
# Upravte mapovÃ¡nÃ­ v aes()
# - barva podle kategorie
# - velikost podle hodnoty
# - prÅ¯hlednost


```

## Krok 3: NastavenÃ­ vzhledu

VylepÅ¡ete vzhled grafu pomocÃ­ tÃ©mat, Å¡kÃ¡l a popiskÅ¯.

```{r ukol_c_krok3}
# PouÅ¾ijte theme_*()
# Upravte popisky pomocÃ­ labs()
# Nastavte Å¡kÃ¡ly (scale_*())


```

## FinÃ¡lnÃ­ graf

```{r ukol_c_final}
# Zkombinujte vÅ¡echny pÅ™edchozÃ­ kroky do jednoho komplexnÃ­ho grafu


```

---

# ğŸ“ˆ Typy grafÅ¯ v ggplot2

## SpojitÃ© promÄ›nnÃ©

```r
# BodovÃ½ graf
ggplot(data, aes(x = var1, y = var2)) +
  geom_point()

# ÄŒÃ¡rovÃ½ graf
ggplot(data, aes(x = time, y = value)) +
  geom_line()

# PloÅ¡nÃ½ graf
ggplot(data, aes(x = time, y = value)) +
  geom_area()

# VyhlazenÃ¡ kÅ™ivka
ggplot(data, aes(x = var1, y = var2)) +
  geom_smooth()
```

## RozdÄ›lenÃ­ dat

```r
# Histogram
ggplot(data, aes(x = variable)) +
  geom_histogram(bins = 30)

# HustotnÃ­ graf
ggplot(data, aes(x = variable)) +
  geom_density()

# KrabicovÃ½ graf
ggplot(data, aes(x = category, y = value)) +
  geom_boxplot()

# HouslovÃ½ graf
ggplot(data, aes(x = category, y = value)) +
  geom_violin()
```

## KategorickÃ© promÄ›nnÃ©

```r
# SloupcovÃ½ graf
ggplot(data, aes(x = category)) +
  geom_bar()

# SloupcovÃ½ graf s hodnotami
ggplot(data, aes(x = category, y = value)) +
  geom_col()

# SeskupenÃ½ sloupcovÃ½ graf
ggplot(data, aes(x = category, y = value, fill = group)) +
  geom_col(position = "dodge")
```

---

# ğŸ¯ EstetickÃ© mapovÃ¡nÃ­ (aes)

EstetickÃ© vlastnosti mÅ¯Å¾eme mapovat na promÄ›nnÃ©:

```r
ggplot(data, aes(x = var1, 
                 y = var2,
                 color = category,    # barva podle kategorie
                 size = value,        # velikost podle hodnoty
                 shape = type,        # tvar podle typu
                 alpha = weight,      # prÅ¯hlednost podle vÃ¡hy
                 linetype = group))   # typ ÄÃ¡ry podle skupiny
```

**DÅ¯leÅ¾itÃ©:**
- MapovÃ¡nÃ­ uvnitÅ™ `aes()` â†’ promÄ›nnÃ¡
- PevnÃ© hodnoty mimo `aes()` â†’ konstanta

```r
# âœ… SprÃ¡vnÄ› - mapovÃ¡nÃ­ na promÄ›nnou
geom_point(aes(color = category))

# âœ… SprÃ¡vnÄ› - pevnÃ¡ hodnota
geom_point(color = "blue")

# âŒ Chyba - pevnÃ¡ hodnota v aes()
geom_point(aes(color = "blue"))
```

---

# ğŸ¨ FacetovÃ¡nÃ­

## facet_wrap()

Pro rozdÄ›lenÃ­ podle jednÃ© promÄ›nnÃ©:

```r
ggplot(data, aes(x = var1, y = var2)) +
  geom_point() +
  facet_wrap(~ category, ncol = 2)
```

## facet_grid()

Pro rozdÄ›lenÃ­ podle dvou promÄ›nnÃ½ch:

```r
# Å˜Ã¡dky ~ Sloupce
ggplot(data, aes(x = var1, y = var2)) +
  geom_point() +
  facet_grid(rows_var ~ cols_var)

# Pouze Å™Ã¡dky
facet_grid(rows_var ~ .)

# Pouze sloupce
facet_grid(. ~ cols_var)
```

---

# ğŸ­ TÃ©mata a vzhled

## VestavÄ›nÃ¡ tÃ©mata

```r
theme_gray()      # vÃ½chozÃ­
theme_bw()        # ÄernobÃ­lÃ©
theme_minimal()   # minimalistickÃ©
theme_classic()   # klasickÃ©
theme_light()     # svÄ›tlÃ©
theme_dark()      # tmavÃ©
```

## VlastnÃ­ Ãºpravy

```r
ggplot(data, aes(x = var1, y = var2)) +
  geom_point() +
  labs(
    title = "HlavnÃ­ nadpis",
    subtitle = "Podnadpis",
    x = "Popis osy X",
    y = "Popis osy Y",
    caption = "Zdroj dat"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold"),
    axis.text = element_text(size = 12),
    legend.position = "bottom"
  )
```

---

# ğŸŒˆ Å kÃ¡ly a barvy

## SpojitÃ© Å¡kÃ¡ly

```r
# Ãšprava osy X
scale_x_continuous(limits = c(0, 100), breaks = seq(0, 100, 20))

# LogaritmickÃ¡ Å¡kÃ¡la
scale_y_log10()

# BarevnÃ¡ Å¡kÃ¡la pro spojitÃ© hodnoty
scale_color_gradient(low = "blue", high = "red")
scale_color_viridis_c()  # viridis paleta
```

## DiskrÃ©tnÃ­ Å¡kÃ¡ly

```r
# ManuÃ¡lnÃ­ barvy
scale_color_manual(values = c("red", "blue", "green"))

# VestavÄ›nÃ© palety
scale_color_brewer(palette = "Set1")
scale_color_viridis_d()  # viridis paleta (diskrÃ©tnÃ­)
```

---

# ğŸ’¡ DÅ¯leÅ¾itÃ© poznÃ¡mky

## Anatomie ggplot grafu

```r
ggplot(data = <DATA>) +                    # 1. Data
  <GEOM_FUNCTION>(                         # 2. Geom
    mapping = aes(<MAPPINGS>),             # 3. MapovÃ¡nÃ­
    stat = <STAT>,                         # 4. StatistickÃ¡ transformace
    position = <POSITION>                  # 5. Pozice
  ) +
  <COORDINATE_FUNCTION> +                  # 6. SouÅ™adnicovÃ½ systÃ©m
  <FACET_FUNCTION> +                       # 7. Facety
  <SCALE_FUNCTION> +                       # 8. Å kÃ¡ly
  <THEME_FUNCTION>                         # 9. TÃ©ma
```

## ÄŒastÃ© problÃ©my a Å™eÅ¡enÃ­

### ProblÃ©m 1: PÅ™ekrÃ½vajÃ­cÃ­ se body

```r
# âŒ Body se pÅ™ekrÃ½vajÃ­
geom_point()

# âœ… PÅ™idÃ¡nÃ­ prÅ¯hlednosti
geom_point(alpha = 0.5)

# âœ… PouÅ¾itÃ­ jitter
geom_jitter(width = 0.2, height = 0.2)
```

### ProblÃ©m 2: PÅ™eplnÄ›nÃ© popisky

```r
# âŒ NeÄitelnÃ© popisky na ose X
ggplot(data, aes(x = category, y = value)) +
  geom_col()

# âœ… OtoÄenÃ­ popiskÅ¯
ggplot(data, aes(x = category, y = value)) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# âœ… Nebo otoÄenÃ­ souÅ™adnic
ggplot(data, aes(x = category, y = value)) +
  geom_col() +
  coord_flip()
```

### ProblÃ©m 3: AutomatickÃ© bins v histogramu

```r
# âš ï¸ VarovÃ¡nÃ­ o automatickÃ©m poÄtu binÅ¯
ggplot(data, aes(x = variable)) +
  geom_histogram()

# âœ… ExplicitnÃ­ nastavenÃ­
ggplot(data, aes(x = variable)) +
  geom_histogram(bins = 30)
# nebo
ggplot(data, aes(x = variable)) +
  geom_histogram(binwidth = 5)
```

---

# ğŸ“Š KombinovÃ¡nÃ­ geomÅ¯

MÅ¯Å¾ete kombinovat vÃ­ce geomÅ¯ v jednom grafu:

```r
ggplot(data, aes(x = var1, y = var2)) +
  geom_point(alpha = 0.5) +              # Body
  geom_smooth(method = "lm", se = TRUE) + # TrendovÃ¡ ÄÃ¡ra
  geom_hline(yintercept = 0, linetype = "dashed") # HorizontÃ¡lnÃ­ ÄÃ¡ra
```

---

# ğŸ’¾ UklÃ¡dÃ¡nÃ­ grafÅ¯

```r
# VytvoÅ™enÃ­ grafu
p <- ggplot(data, aes(x = var1, y = var2)) +
  geom_point()

# UloÅ¾enÃ­
ggsave("muj_graf.png", plot = p, width = 8, height = 6, dpi = 300)

# RÅ¯znÃ© formÃ¡ty
ggsave("muj_graf.pdf", plot = p)
ggsave("muj_graf.svg", plot = p)
```

---

# ğŸ¯ Checklist

- [ ] RozumÃ­m struktuÅ™e ggplot grafu (data + geom + aes)?
- [ ] VÃ­m, kdy pouÅ¾Ã­t mapovÃ¡nÃ­ v aes() a kdy mimo nÄ›j?
- [ ] DokÃ¡Å¾u vytvoÅ™it rÅ¯znÃ© typy grafÅ¯ (body, ÄÃ¡ry, sloupcovÃ©, histogramy)?
- [ ] UmÃ­m pouÅ¾Ã­t facetovÃ¡nÃ­ pro rozdÄ›lenÃ­ dat?
- [ ] VÃ­m, jak upravit tÃ©mata a vzhled grafu?
- [ ] DokÃ¡Å¾u pracovat se Å¡kÃ¡lami a barvami?
- [ ] UmÃ­m kombinovat vÃ­ce geomÅ¯ v jednom grafu?

---

# ğŸ”— UÅ¾iteÄnÃ© odkazy

- [ggplot2 cheatsheet](https://github.com/rstudio/cheatsheets/blob/main/data-visualization.pdf)
- [R for Data Science - Data visualization](https://r4ds.had.co.nz/data-visualisation.html)
- [ggplot2 documentation](https://ggplot2.tidyverse.org/)
- [R Graph Gallery](https://r-graph-gallery.com/)
- [ggplot2 extensions](https://exts.ggplot2.tidyverse.org/)

---

<div style="text-align: center; margin-top: 50px; padding: 20px; background-color: #f0f0f0; border-radius: 10px;">
**VytvorenÃ© pre:** MPE_AVED, TÃ½Å¾deÅˆ 9, ECON MUNI  
**DÃ¡tum:** `r Sys.Date()`
</div>
